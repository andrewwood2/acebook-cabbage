def sign_up_and_in
  valid_attributes = {
    name: 'Bob',
    email: 'bob@bob.com',
    password: '123456',
    password_confirmation: '123456'
  }
  Users::RegistrationsController

  @request.env["devise.mapping"] = Devise.mappings[:user]
  post :create, params: {user: valid_attributes}, controller: 'users/registrations'
  Users::SessionsController
  post :create, params: {user: valid_attributes}, controller: 'users/sessions'

  # post 'users/sign_in', params: {user: {email: 'bob@bob.com', password: '123456'}}

  # .path_parameters

  p response.headers
  return response.headers.authorization
end
#
# <ActionDispatch::TestResponse:0x00007fe479a53f60 @mon_owner=nil, @mon_count=0, @mon_mutex=#<Thread::Mutex:0x00007fe479a53ec0>, @header={"X-Frame-Options"=>"SAMEORIGIN", "X-XSS-Protection"=>"1; mode=block", "X-Content-Type-Options"=>"nosniff", "Content-Type"=>"text/html; charset=utf-8"}, @stream=#<ActionDispatch::Response::Buffer:0x00007fe479a570e8 @response=#<ActionDispatch::TestResponse:0x00007fe479a53f60 ...>, @buf=["You need to sign in or sign up before continuing."], @closed=false, @str_body=nil>, @status=401, @cv=#<MonitorMixin::ConditionVariable:0x00007fe479a53e48 @monitor=#<ActionDispatch::TestResponse:0x00007fe479a53f60 ...>, @cond=#<Thread::ConditionVariable:0x00007fe479a53e20>>, @committed=true, @sending=false, @sent=true, @cache_control={}, @response_parser=#<Proc:0x00007fe479a53c68@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/actionpack-5.1.6/lib/action_dispatch/testing/request_encoder.rb:7 (lambda)>, @request=#<ActionController::TestRequest:0x00007fe47e8903b8 @env={"rack.version"=>[1, 3], "rack.input"=>#<StringIO:0x00007fe479a52c50>, "rack.errors"=>#<StringIO:0x00007fe47a5f2218>, "rack.multithread"=>true, "rack.multiprocess"=>true, "rack.run_once"=>false, "REQUEST_METHOD"=>"POST", "SERVER_NAME"=>"example.org", "SERVER_PORT"=>"80", "QUERY_STRING"=>"", "rack.url_scheme"=>"http", "HTTPS"=>"off", "SCRIPT_NAME"=>"", "CONTENT_LENGTH"=>"55", "HTTP_HOST"=>"test.host", "REMOTE_ADDR"=>"0.0.0.0", "HTTP_USER_AGENT"=>"Rails Testing", "action_dispatch.parameter_filter"=>[:password], "action_dispatch.redirect_filter"=>[], "action_dispatch.secret_token"=>nil, "action_dispatch.secret_key_base"=>"0b3517aa2d898b5a23462ce7a34cec67cf628077e9ff7997a686be57eb24589a72d703e50c4339d28211cf3cae361eb7d4979df4305f7bc2e4da4f59773203c7", "action_dispatch.show_exceptions"=>false, "action_dispatch.show_detailed_exceptions"=>true, "action_dispatch.logger"=>#<ActiveSupport::Logger:0x00007fe47a9ed6b0 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe47a9ed5c0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe47a61d878 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:70309641251900">, @logdev=#<Logger::LogDevice:0x00007fe47a9ed570 @shift_period_suffix=nil, @shift_size=nil, @shift_age=nil, @filename=nil, @dev=#<File:/Users/andrewwood/Documents/Projects/acebook-gazelle/log/test.log>, @mon_owner=nil, @mon_count=0, @mon_mutex=#<Thread::Mutex:0x00007fe47a9ed4f8>>, @local_levels=#<Concurrent::Map:0x007fe47a9ed3e0 entries=0 default_proc=nil>>, "action_dispatch.backtrace_cleaner"=>#<Rails::BacktraceCleaner:0x00007fe47dc372b0 @filters=[#<Proc:0x00007fe47dc37198@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/railties-5.1.6/lib/rails/backtrace_cleaner.rb:14>, #<Proc:0x00007fe47dc37170@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/railties-5.1.6/lib/rails/backtrace_cleaner.rb:15>, #<Proc:0x00007fe47dc37148@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/railties-5.1.6/lib/rails/backtrace_cleaner.rb:16>, #<Proc:0x00007fe47dc369f0@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/railties-5.1.6/lib/rails/backtrace_cleaner.rb:29>], @silencers=[#<Proc:0x00007fe47dc369c8@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/railties-5.1.6/lib/rails/backtrace_cleaner.rb:19>], @root="/Users/andrewwood/Documents/Projects/acebook-gazelle/">, "action_dispatch.key_generator"=>#<ActiveSupport::CachingKeyGenerator:0x00007fe47a7c8ba0 @key_generator=#<ActiveSupport::KeyGenerator:0x00007fe47a7c8c18 @secret="0b3517aa2d898b5a23462ce7a34cec67cf628077e9ff7997a686be57eb24589a72d703e50c4339d28211cf3cae361eb7d4979df4305f7bc2e4da4f59773203c7", @iterations=1000>, @cache_keys=#<Concurrent::Map:0x007fe47a7c8b78 entries=2 default_proc=nil>>, "action_dispatch.http_auth_salt"=>"http authentication", "action_dispatch.signed_cookie_salt"=>"signed cookie", "action_dispatch.encrypted_cookie_salt"=>"encrypted cookie", "action_dispatch.encrypted_signed_cookie_salt"=>"signed encrypted cookie", "action_dispatch.cookies_serializer"=>:json, "action_dispatch.cookies_digest"=>nil, "rack.session"=>{}, "rack.session.options"=>{:key=>"rack.session", :path=>"/", :domain=>nil, :expire_after=>nil, :secure=>false, :httponly=>true, :defer=>false, :renew=>false, :sidbits=>128, :cookie_only=>true, :secure_random=>SecureRandom}, "action_controller.instance"=>#<Devise::FailureApp:0x00007fe47e871d78 @_routes=nil, @_request=#<ActionDispatch::Request:0x00007fe47e872110 @env={...}, @filtered_parameters=nil, @filtered_env=nil, @filtered_path=nil, @protocol=nil, @port=nil, @method=nil, @request_method=nil, @remote_ip=nil, @original_fullpath=nil, @fullpath=nil, @ip=nil>, @_response=#<ActionDispatch::Response:0x00007fe47e8720c0 @mon_owner=nil, @mon_count=0, @mon_mutex=#<Thread::Mutex:0x00007fe47e871fd0>, @header={"Content-Type"=>"text/html; charset=utf-8"}, @stream=#<ActionDispatch::Response::Buffer:0x00007fe479a574a8 @response=#<ActionDispatch::Response:0x00007fe47e8720c0 ...>, @buf=["You need to sign in or sign up before continuing."], @closed=false, @str_body="You need to sign in or sign up before continuing.">, @status=401, @cv=#<MonitorMixin::ConditionVariable:0x00007fe47e871f08 @monitor=#<ActionDispatch::Response:0x00007fe47e8720c0 ...>, @cond=#<Thread::ConditionVariable:0x00007fe47e871ee0>>, @committed=true, @sending=false, @sent=false, @cache_control={}, @request=#<ActionDispatch::Request:0x00007fe47e872110 @env={...}, @filtered_parameters=nil, @filtered_env=nil, @filtered_path=nil, @protocol=nil, @port=nil, @method=nil, @request_method=nil, @remote_ip=nil, @original_fullpath=nil, @fullpath=nil, @ip=nil>>, @_action_name="respond", @_response_body=["You need to sign in or sign up before continuing."], @request_format=:html, @scope=:user, @scope_class=User(id: integer, name: string, email: string, encrypted_password: string, profilepic: string, reset_password_token: string, reset_password_sent_at: datetime, remember_created_at: datetime, created_at: datetime, updated_at: datetime), @message=nil>, "warden"=>Warden::Proxy:70309669772000 @config={:default_scope=>:user, :scope_defaults=>{}, :default_strategies=>{:user=>[:jwt, :rememberable, :database_authenticatable]}, :intercept_401=>false, :failure_app=>#<Devise::Delegator:0x00007fe47b675018>}, "devise.mapping"=>#<Devise::Mapping:0x00007fe47a2c56d0 @scoped_path="users", @singular=:user, @class_name="User", @klass=#<Devise::Getter:0x00007fe47a2c1cd8 @name="User">, @path="users", @path_prefix=nil, @sign_out_via=:delete, @format=nil, @router_name=nil, @failure_app=Devise::FailureApp, @controllers={:sessions=>"users/sessions", :registrations=>"users/registrations", :passwords=>"devise/passwords"}, @path_names={:registration=>"", :new=>"new", :edit=>"edit", :sign_in=>"sign_in", :sign_out=>"sign_out", :password=>"password", :sign_up=>"sign_up", :cancel=>"cancel"}, @modules=[:database_authenticatable, :rememberable, :recoverable, :registerable, :validatable, :jwt_authenticatable], @routes=[:session, :password, :registration], @used_routes=[:session, :password, :registration], @used_helpers=[:session, :password, :registration]>, "HTTP_COOKIE"=>"", "CONTENT_TYPE"=>"application/x-www-form-urlencoded", "PATH_INFO"=>"/unauthenticated", "rack.tempfiles"=>[], "warden.options"=>{:scope=>:user, :action=>:unauthenticated}, "action_dispatch.request.content_type"=>#<Mime::Type:0x00007fe47b56e840 @synonyms=[], @symbol=:url_encoded_form, @string="application/x-www-form-urlencoded", @hash=281821325644403741>, "action_dispatch.request.path_parameters"=>{:controller=>"posts", :action=>"create"}, "action_dispatch.request.flash_hash"=>#<ActionDispatch::Flash::FlashHash:0x00007fe479a529f8 @discard=#<Set: {}>, @flashes={}, @now=nil>, "rack.request.form_hash"=>{"user"=>{"email"=>"bob@bob.com", "password"=>"123456"}}, "rack.request.form_vars"=>"user%5Bemail%5D=bob%40bob.com&user%5Bpassword%5D=123456", "rack.request.form_input"=>#<StringIO:0x00007fe479a52c50>, "action_dispatch.request.request_parameters"=>{"user"=>{"email"=>"bob@bob.com", "password"=>"123456"}}, "rack.request.query_string"=>"", "rack.request.query_hash"=>{}, "action_dispatch.request.query_parameters"=>{}, "action_dispatch.request.parameters"=>{"user"=>{"email"=>"bob@bob.com", "password"=>"123456"}, "controller"=>"posts", "action"=>"create"}, "action_dispatch.request.formats"=>[#<Mime::Type:0x00007fe47b58bdf0 @synonyms=["application/xhtml+xml"], @symbol=:html, @string="text/html", @hash=3732068482719767172>], "rack.request.cookie_hash"=>{}, "rack.request.cookie_string"=>"", "action_dispatch.cookies"=>#<ActionDispatch::Cookies::CookieJar:0x00007fe47e873358 @set_cookies={}, @delete_cookies={}, @request=#<ActionDispatch::Request:0x00007fe47dc8a870 @env={...}, @filtered_parameters=nil, @filtered_env=nil, @filtered_path=nil, @protocol=nil, @port=nil, @method=nil, @request_method=nil, @remote_ip=nil, @original_fullpath=nil, @fullpath=nil, @ip=nil>, @cookies={}, @committed=false, @signed=#<ActionDispatch::Cookies::SignedCookieJar:0x00007fe47e8731a0 @parent_jar=#<ActionDispatch::Cookies::CookieJar:0x00007fe47e873358 ...>, @verifier=#<ActiveSupport::MessageVerifier:0x00007fe47e873088 @secret="\xF76\x1E&\x8D(P\x18Y\x06\xAB?\xCBR\xD6\n\x87Iq!*\xC3\xEB\xA2\x02\xB89\x8C\xA6\x95\"\xEF\xC5y\xEC\xC8\xA5t\x01CCZ\x12\xFC\x02\x97\x0E\x01\xE98~y\xB6\xB2\x8F\xA1o\xE9t0?\xAC3R", @digest="SHA1", @serializer=ActiveSupport::MessageEncryptor::NullSerializer>>>}, @filtered_parameters={"user"=>{"email"=>"bob@bob.com", "password"=>"[FILTERED]"}, "controller"=>"posts", "action"=>"create"}, @filtered_env=nil, @filtered_path=nil, @protocol=nil, @port=nil, @method=nil, @request_method="POST", @remote_ip=nil, @original_fullpath=nil, @fullpath="/unauthenticated", @ip=nil, @controller_class=PostsController, @custom_param_parsers={:xml=>#<Proc:0x00007fe47e890020@/Users/andrewwood/.rvm/gems/ruby-2.5.0/gems/actionpack-5.1.6/lib/action_controller/test_case.rb:58 (lambda)>}, @headers=#<ActionDispatch::Http::Headers:0x00007fe479a50b08 @req=#<ActionController::TestRequest:0x00007fe47e8903b8 ...>>>>
